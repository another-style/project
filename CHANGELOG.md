# Changelog

## 2026-02-23

### Добавлено
- **Загрузка изображений к комментариям** — к каждому комментарию можно прикрепить до 5 изображений (форматы: JPG, PNG, WebP). Файлы сохраняются под md5-именем в вложенной структуре директорий (глубина 3, по первым символам имени файла). Все загружаемые файлы проверяются на уровне PHP через `getimagesize()`.
- **Лайтбокс для просмотра изображений** — клик по миниатюре открывает изображение в попапе с тёмным оверлеем, навигацией стрелками, счётчиком и закрытием по Escape/клику на фон. Реализован через переиспользуемый компонент `ImageGallery.vue`.
- **Изображения на главной странице** — миниатюры прикреплённых изображений отображаются в карточках тем; лайтбокс работает без перехода на страницу темы.
- **Управление изображениями в админ-панели** — на странице редактирования комментария появилась вкладка «Изображения» с превью, именем файла и возможностью удаления. При удалении изображение откреп­ляется от комментария; если оно больше ни к чему не привязано — физический файл и запись удаляются с диска.
- **Permission `CommentImage.delete`** — право на удаление изображений в админ-панели, назначается через раздел Роли/Права.
- **Таблицы БД**: `comment_images` и `comment_comment_image` (pivot).

### Улучшено
- **Расширена ширина макета** — максимальная ширина контентной области увеличена с `max-w-3xl` до `max-w-4xl` на главной странице и странице просмотра темы.
- **Увеличен размер текста сообщений** — текст комментариев и тем изменён с `text-sm` на `text-base`.
- **Изображения перенесены выше текста** — в карточке комментария миниатюры теперь отображаются над текстом сообщения.
- **Увеличен отступ между изображениями и текстом** — добавлено дополнительное пространство между блоком изображений и текстом комментария.

### Исправлено
- Исправлена ошибка «mkdir: No such file or directory» при первой загрузке изображения — базовая директория теперь создаётся автоматически.
- Исправлено поведение выбора нескольких изображений в форме: повторный выбор файлов теперь добавляет их к уже выбранным, а не заменяет.
- Исправлена ошибка перехода на страницу темы при клике по изображению на главной странице — блок `ImageGallery` вынесен за пределы элемента `<Link>`.

## 2026-02-20

### Добавлено
- **Закрепление комментариев (pin)** — администратор может закреплять темы через админку Filament. Закреплённые темы отображаются первыми на главной странице с визуальным бейджем «Закреплено». Авторизация через permission `Comment.pin`.
- **Разметка Markdown** — комментарии и посты теперь поддерживают форматирование Markdown (заголовки, жирный, курсив, зачёркнутый текст, списки, цитаты, код, горизонтальные линии) через библиотеку `league/commonmark`.
- **Теги** — возможность привязывать теги к комментариям (связь many-to-many).
- **Rate Limiter** — ограничение частоты запросов для защиты от злоупотреблений.
- **Описание проекта** — добавлено описание в README.

### Исправлено
- Правки в CSS-стилях.
- Исправлено отображение переносов строк — одиночный перенос строки теперь корректно рендерится как `<br>` в Markdown.
- Добавлена поддержка заголовков (`h1`–`h6`) и горизонтальных линий (`hr`) в Markdown-рендерере и CSS-стилях.

## 2026-02-19

### Добавлено
- **Лайки и дизлайки** — система голосования за комментарии (привязка по IP).
- **Адаптивная вёрстка** — адаптация интерфейса под мобильные устройства и малые экраны.
- **Навигация** — добавлена ссылка на главную страницу.

### Исправлено
- Изменён формат URL последнего комментария в теме.
- Обновлён `CLAUDE.md` с актуальной документацией по проекту.

## 2026-02-18

### Добавлено
- **Функционал комментариев** — иерархическая система комментариев (темы и ответы) на базе пакета `kalnoy/nestedset` с поддержкой вложенности.
- **Seeder комментариев** — генерация тестовых данных для комментариев.
- **Сортировка тем** — темы отсортированы по дате последнего комментария (bump-механика).

### Исправлено
- Настроен алиас `ziggy-js` в `vite.config.js` для корректного резолва пакета Ziggy при сборке.
- Указан полный путь до ESM-модуля Ziggy (`vendor/tightenco/ziggy/dist/index.esm.js`).
- Docker: переключение на зеркало Яндекса (`mirror.yandex.ru`) вместо `deb.debian.org` для ускорения сборки образа.
- Исправлена ошибка с маршрутом `/dashboard`.
- Исправлена JS-ошибка на фронтенде.
- Правки в user seeder.

## 2026-02-17

### Добавлено
- **Инициализация проекта** — Laravel 12 + Inertia.js + Vue 3 + Filament 3.
- **Docker-окружение** — `docker-compose.yml` с сервисами PHP-FPM, Nginx, MySQL 8, Redis, Node (Vite dev-server).
- **Админ-панель (Filament)** — ресурс управления пользователями (`UserResource`).
- **Роли и разрешения** — интеграция `spatie/laravel-permission`, ресурсы `RoleResource` и `PermissionResource` в админ-панели.
- **Политики авторизации** — `UserPolicy`, `RolePolicy`, `PermissionPolicy` с проверкой активности пользователя (`is_active`).
- **IDE Helper** — добавлен `barryvdh/laravel-ide-helper` для автодополнения в IDE.
- **MCP-сервер** — инструкция по подключению к MySQL через MCP.

### Исправлено
- Правки в конфигурации Vite, добавлено сидирование в `composer.json`.
- Конфигурация портов Docker-сервисов.
- Исправлена миграция.
- Изменён порядок заполнения прав доступа при развёртывании проекта.
